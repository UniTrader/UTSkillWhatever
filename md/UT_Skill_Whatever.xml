<?xml version="1.0" encoding="UTF-8"?>
<mdscript xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" name="UT_Skill_Whatever" xsi:noNamespaceSchemaLocation="http://utnas/~unitrader/XRebirthxsds/md.xsd">
  <cues>
    <cue name="Init" checktime="5s" checkinterval="5s">
      <conditions>
        <cue_is_complete cue="md.Setup.Start"/>
      </conditions>
      <actions>
        <!-- set all player Skills to 0 - we want him to build them up himself ;) -->
        <set_skill entity="player.entity" type="skilltype.boarding" exact="0"/>
        <set_skill entity="player.entity" type="skilltype.combat" exact="0"/>
        <set_skill entity="player.entity" type="skilltype.engineering" exact="0"/>
        <set_skill entity="player.entity" type="skilltype.leadership" exact="0"/>
        <set_skill entity="player.entity" type="skilltype.management" exact="0"/>
        <set_skill entity="player.entity" type="skilltype.morale" exact="0"/>
        <set_skill entity="player.entity" type="skilltype.navigation" exact="0"/>
        <set_skill entity="player.entity" type="skilltype.science" exact="0"/>
      </actions>
    </cue>
    <cue name="Change_Player_Skills" instantiate="true" comment="based on player interaction">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
        <set_value name="$actor" exact="event.param"/>
        <set_value name="$relevantskills" exact="$actor.type.skilltypes"/>
        <set_value name="$irrelevantskills" exact="[skilltype.boarding , skilltype.combat , skilltype.engineering , skilltype.leadership , skilltype.management , skilltype.morale , skilltype.navigation , skilltype.science]"/>
        <do_all exact="$relevantskills.count" counter="$i">
          <remove_value name="$irrelevantskills.indexof.{$relevantskills.{$i}}"/>
          <!-- if player has already 5 Stars in this Skill - remove it -->
          <do_if value="player.entity.skill.{$relevantskills.{$i}} ge 5">
            <remove_value name="$relevantskills.indexof.{$relevantskills.{$i}}"/>
          </do_if>
        </do_all>
        <!-- if there are no relevant skills to improve - dont do anything -->
        <do_if value="$relevantskills.count">
          <do_any>
            <add_skill entity="player.entity" type="$relevantskills.{1}" weight="$actor.skillrelevance.{$relevantskills.{1}}"/>
            <add_skill entity="player.entity" type="@$relevantskills.{2}" weight="@$actor.skillrelevance.{@$relevantskills.{2}}" comment="may not exist"/>
            <add_skill entity="player.entity" type="@$relevantskills.{3}" weight="@$actor.skillrelevance.{@$relevantskills.{3}}" comment="may not exist"/>
            <add_skill entity="player.entity" type="@$relevantskills.{4}" weight="@$actor.skillrelevance.{@$relevantskills.{4}}" comment="should not exist - just in case for compatibility"/>
            <add_skill entity="player.entity" type="@$relevantskills.{5}" weight="@$actor.skillrelevance.{@$relevantskills.{5}}" comment="should not exist - just in case for compatibility"/>
          </do_any>
          <!-- If the Player total Skill is over 25 - reduce a Skill not relevant to the NPC the player just interacted with -->
          <do_while value="player.entity.skill.boarding+player.entity.skill.combat+player.entity.skill.engineering + player.entity.skill.leadership + player.entity.skill.management+player.entity.skill.morale + player.entity.skill.navigation + player.entity.skill.science gt 25">
            <set_value name="$skill" exact="$irrelevantskills.random"/>
            <do_if value="player.entity.skill.{$skill}">
              <add_skill entity="entity.player" type="$irrelevantskills.random" exact="-1"/>
            </do_if>
            <!-- if player skill is 0 in this remove skill from the choices -->
            <do_else>
              <remove_value name="$irrelevantskills.indexof.{$skill}"/>
            </do_else>
          </do_while>
        </do_if>
      </actions>
    </cue>
    <cue name="Event_hired" instantiate="true">
      <conditions>
        <event_cue_signalled cue="md.NPC_Staff.LogHired"/>
      </conditions>
      <actions>
        <signal_cue_instantly cue="Change_Player_Skills" param="event.param" comment="simply pass through the actor"/>
      </actions>
    </cue>
    <cue name="Event_smalltalk_completed" instantiate="true">
      <conditions>
        <event_conversation_next_section section="gSmalltalk_step"/>
      </conditions>
      <actions>
        <set_value name="$bonus" exact="event.param2.{4}"/>
        <do_if value="not event.param2.{7}" comment="no $stepsleft - smalltalk is over">
          <do_if value="event.param2.{4} ge 3 and event.param2.{3} lt" comment="successful smalltalk without penalty">
            <signal_cue_instantly cue="Change_Player_Skills" param="event.object" comment="simply pass through the actor"/>
          </do_if>
          <do_if value="event.param2.{4} ge 5 and event.param2.{3} lt 1" comment="very successful smalltalk without penalty">
            <signal_cue_instantly cue="Change_Player_Skills" param="event.object" comment="simply pass through the actor"/>
          </do_if>
          <do_if value="event.param2.{4} gt 7 and event.param2.{3} le 1" comment="extremely successful smalltalk with little penalty">
            <signal_cue_instantly cue="Change_Player_Skills" param="event.object" comment="simply pass through the actor"/>
          </do_if>
        </do_if>
      </actions>
    </cue>
    <cue name="Event_Conversation_started">
      <conditions>
        <event_conversation_started/>
      </conditions>
      <actions>
        <set_value name="$revealskills" exact="true"/>
        <set_value name="$relevantskills" exact="$actor.type.skilltypes"/>
        <do_if value="$relevantskills.count">
          <!-- reveal skills when relevant skills of player are higher -->
          <do_all exact="$relevantskills.count" counter="$i">
            <do_if value="$actor.skill.{$relevantskills..{$i}} gt player.entity.skill.{$relevantskills..{$i}}">
              <set_value name="$revealskills" exact="false"/>
            </do_if>
          </do_all>
          <do_if value="$revealskills">
            <set_skills_visible entity="$actor" visible="true"/>
          </do_if>
        </do_if>
      </actions>
    </cue>
  </cues>
</mdscript>
